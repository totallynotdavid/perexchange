[settings]
python.uv_venv_auto = true

[tools]
uv = "0.9.10"
ruff = "0.14.5"

[tasks.sync]
description = "Sync dependencies for all packages and dev"
run = "uv sync --all-packages --extra dev"

[tasks.test]
description = "Run tests for core package"
run = "uv run pytest pkg/core"

[tasks.test-integration]
description = "Run integration tests for core package"
run = "uv run pytest pkg/core -m integration"

[tasks.format]
description = "Format all packages"
run = "ruff format . && ruff check --fix ."

[tasks.lint]
description = "Run type checking"
run = "uv run mypy"

[tasks.update]
description = "Update dependencies for all packages"
alias = "u"
run = ["uv sync --all-packages --extra dev -U"]

[tasks.export-deps]
description = "Export production dependencies for core"
run = "uv export --format requirements-txt --no-hashes --no-header --no-dev --no-annotate --output-file requirements.txt"
dir = "pkg/core"

[tasks.build]
description = "Build core package"
run = "uv build"
dir = "pkg/core"

[tasks.build-check]
description = "Build and verify package contents"
run = "uv run python tools/build_check.py"

[tasks.check]
description = "Run before pushing: being quick: format, lint, test"
depends = ["format", "lint", "test"]

[tasks.release]
description = "Full release process: update version, build, commit, tag, push"
usage = 'arg "<version>" help="Version to release (e.g., 1.2.3)"'
run = 'uv run python tools/release.py --version {{arg(name="version")}}'

[tasks.update-version]
description = "Update version in pyproject.toml"
usage = 'arg "<version>" help="Version to set (e.g., 1.2.3)"'
run = 'uv run python tools/update_version.py --version {{arg(name="version")}}'
